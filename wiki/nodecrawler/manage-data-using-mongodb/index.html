<!doctype html><html lang=en-us><head><meta name=generator content="Hugo 0.69.2"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Manage Data Using MongoDB | Datumorphism | Lei Ma</title><meta name=author content="Lei Ma"><meta property="og:title" content="Manage Data Using MongoDB"><meta property="og:description" content="In most cases, databases makes the management of data quite convenient. In this article, we would scrape data using the code we discussed before but write data into MongoDB.
For installation of MongoDB, please refer to the official documentation.
The Code To write data to MongoDB using Node.js, we choose the package mongojs, which provides almost exactly the standard MongoDB syntax.
To install mongojs,
npm i mongojs --save Here is a module that can write data to MongoDB."><meta property="og:type" content="article"><meta property="og:url" content="https://datumorphism.leima.is/wiki/nodecrawler/manage-data-using-mongodb/"><meta property="article:published_time" content="2018-07-18T00:00:00+00:00"><meta property="article:modified_time" content="2018-07-18T00:00:00+00:00"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-140452515-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=canonical href=https://datumorphism.leima.is/wiki/nodecrawler/manage-data-using-mongodb/><link rel="shortcut icon" type=image/png href=/logos/logo-square.png><link rel=stylesheet href=/css/bulma.css><link rel=stylesheet href=/css/bulma-divider.min.css><link rel=stylesheet href=/assets/css/bulma-ribbon.min.css><link rel=stylesheet href=/assets/css/tooltip.css><link rel=stylesheet href=https://jenil.github.io/bulmaswatch/united/bulmaswatch.min.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=/css/blog-post.css><link rel=stylesheet href=/css/code-highlighting/dark.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=https://unpkg.com/applause-button/dist/applause-button.css><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],tags:'ams',processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']},svg:{fontCache:'global'}};window.addEventListener('load',(event)=>{document.querySelectorAll("mjx-container").forEach(function(x){x.parentElement.classList+='has-jax'})});</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script><script>mermaid.initialize({startOnLoad:true});</script><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js integrity="sha256-KzZiKy0DWYsnwMF+X1DvQngQ2/FxF7MF3Ff72XcpuPs=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ=" crossorigin=anonymous></head><body><header><nav class="navbar is-transparent"><div class=navbar-brand><a class=navbar-item href=/><img src=/site/intelligence.png alt=Datumorphism height=28 style=margin-right:.5em> Datumorphism</a><div class="navbar-burger burger" style=color:#000 data-target=navMenu><span></span><span></span><span></span></div></div><div class=navbar-menu id=navMenu><div class=navbar-start><div class="navbar-item has-dropdown is-hoverable"><a href=/projects class=navbar-link>Notebooks</a><div class=navbar-dropdown><a href=https://datumorphism.leima.is/awesome/ class=navbar-item>Awesome</a>
<a href=https://datumorphism.leima.is/blog/ class=navbar-item>Blog</a>
<a href=https://datumorphism.leima.is/cards/ class=navbar-item>Cards</a>
<a href=https://datumorphism.leima.is/hologram/ class=navbar-item>Hologram</a>
<a href=https://datumorphism.leima.is/reading/ class=navbar-item>Reading Notes</a>
<a href=https://datumorphism.leima.is/til/ class=navbar-item>TIL</a>
<a href=https://datumorphism.leima.is/wiki/ class=navbar-item>Wiki</a></div></div></div><span class=navbar-burger><span></span><span></span><span></span></span><div class=navbar-end><div class=navbar-item><a class=navbar-item href=/blog/>Blog</a>
<a class=navbar-item href=/tags/><i class="fas fa-tags"></i></a><a class=navbar-item href=/graph><i class="fas fa-project-diagram"></i></a><a class=navbar-item href=https://t.me/amneumarkt><i class="fab fa-telegram"></i></a><a class=navbar-item target=blank href=https://github.com/datumorphism><span class=icon><i class="fab fa-github"></i></span></a></div></div></div></nav><script>document.addEventListener('DOMContentLoaded',()=>{const $navbarBurgers=Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'),0);if($navbarBurgers.length>0){$navbarBurgers.forEach(el=>{el.addEventListener('click',()=>{const target=el.dataset.target;const $target=document.getElementById(target);el.classList.toggle('is-active');$target.classList.toggle('is-active');});});}});</script></header><main><div class=container itemscope itemtype=http://schema.org/BlogPosting><meta itemprop=name content="Manage Data Using MongoDB"><meta itemprop=description content="In most cases, databases makes the management of data quite convenient. In this article, we would scrape data using the code we discussed before but write data into MongoDB.
For installation of MongoDB, please refer to the official documentation.
The Code To write data to MongoDB using Node.js, we choose the package mongojs, which provides almost exactly the standard MongoDB syntax.
To install mongojs,
npm i mongojs --save Here is a module that can write data to MongoDB."><meta itemprop=datePublished content="2018-07-18T00:00:00+00:00"><meta itemprop=dateModified content="2018-07-18T00:00:00+00:00"><meta itemprop=wordCount content="399"><meta itemprop=keywords content="Node,Crawler,"><section class=section><div class=container><article class=post><header class=post-header><nav class="breadcrumb has-succeeds-separator is-small" aria-label=breadcrumbs><ul><li><a href=https://datumorphism.leima.is/>Datumorphism</a></li><li><a href=https://datumorphism.leima.is/wiki/>Wiki</a></li><li><a href=https://datumorphism.leima.is/wiki/nodecrawler/>Node Crawler</a></li><li class=active><a href=https://datumorphism.leima.is/wiki/nodecrawler/manage-data-using-mongodb/>Manage Data Using MongoDB</a></li></ul></nav><h1 class="post-title has-text-centered is-size-1" itemprop="name headline">Manage Data Using MongoDB</h1><h2 class="title is-6 has-text-centered"><i class="fas fa-tags" style=margin-right:.5em></i><a href=/tags/node><span class="tag is-warning is-small is-light">#Node</span></a>
<a href=/tags/crawler><span class="tag is-warning is-small is-light">#Crawler</span></a></h2></header><div class=columns><div class="column is-8"><div class=is-divider data-content=NOTIFICATION></div><div class="notification is-warning is-light"><p>The original Chinese article is written by <a href=https://github.com/nintha>ninthakeey</a>. It has been translated and remixed by Datumorphism</p></div><div class=is-divider data-content=ARTICLE></div><div class="content blog-post section" itemprop=articleBody><p>In most cases, databases makes the management of data quite convenient. In this article, we would scrape data using the code we discussed before but write data into MongoDB.</p><p>For installation of MongoDB, please refer to the <a href=https://docs.mongodb.com/manual/installation/>official documentation</a>.</p><h2 id=the-code>The Code</h2><p>To write data to MongoDB using Node.js, we choose the package <a href=https://github.com/mafintosh/mongojs#readme><code>mongojs</code></a>, which provides almost exactly the standard MongoDB syntax.</p><p>To install <code>mongojs</code>,</p><pre><code class=language-terminal data-lang=terminal>npm i mongojs --save
</code></pre><p>Here is a module that can write data to MongoDB. We create a file named <code>dao.js</code> and copy/paste the following code into it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JavaScript data-lang=JavaScript><span style=color:#75715e>// use mongojs
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mongojs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;mongojs&#39;</span>)
<span style=color:#75715e>// connect to the database &#39;simple_spider&#39; in MongoDB and use collection &#39;test&#39;
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>localdb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mongojs</span>(<span style=color:#e6db74>&#39;simple_spider&#39;</span>, [<span style=color:#e6db74>&#39;test&#39;</span>])
<span style=color:#75715e>// a function that saves data to MongoDB
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>saveData</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>data</span>,<span style=color:#a6e22e>cb</span>) =&gt; {
	<span style=color:#a6e22e>localdb</span>.<span style=color:#a6e22e>test</span>.<span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>data</span>, (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>res</span>)=&gt;{
	 	<span style=color:#a6e22e>cb</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>cb</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>res</span>)
	})
}
<span style=color:#75715e>// a function that prints out the data to console
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>printAllData</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>cb</span>) =&gt; {
	<span style=color:#a6e22e>localdb</span>.<span style=color:#a6e22e>test</span>.<span style=color:#a6e22e>find</span>({},(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>docs</span>)=&gt;{
		<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>docs</span>)
		<span style=color:#a6e22e>cb</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>cb</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>docs</span>)
	})
}
<span style=color:#75715e>// close connection to MongoDB in case of memory leak
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>closeMongo</span> <span style=color:#f92672>=</span> () =&gt; <span style=color:#a6e22e>localdb</span>.<span style=color:#a6e22e>close</span>()
<span style=color:#75715e>// expose the functions in this module to the program
</span><span style=color:#75715e></span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
	<span style=color:#a6e22e>saveData</span>,<span style=color:#a6e22e>printAllData</span>,<span style=color:#a6e22e>closeMongo</span>
}
</code></pre></div><div class=card><details><summary class="card-header-title card-toggle card-header">() =></summary><div class=card-content><div class=content><p>In Node.js, <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions>arrow function</a> is keystroke saver for function expressions. It comes without <code>this</code>, arguments, super, etc.</p><p>In the above code, the expression</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JavaScript data-lang=JavaScript><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>printAllData</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>cb</span>) =&gt; {
  <span style=color:#75715e>// ...
</span><span style=color:#75715e></span>}
</code></pre></div><p>defines a function named <code>printAllData</code> with argument <code>cb</code> and does something as indicated inside the curly bracket.</p></div></div></details></div><p>Three functions are provided in this module, <code>saveData</code>, <code>printAllData</code> and <code>closeMongo</code>. We will grab our previous code and call the functions from this module. We would like to modify the <code>index.js</code> file to make it look like the following.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JavaScript data-lang=JavaScript><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>superagent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;superagent&#39;</span>)
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;fs&#39;</span>)
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dao</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;./dao&#39;</span>)
<span style=color:#a6e22e>superagent</span>
	.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;https://api.bilibili.com/x/web-interface/archive/stat&#39;</span>)
	.<span style=color:#a6e22e>query</span>({ <span style=color:#a6e22e>aid</span><span style=color:#f92672>:</span><span style=color:#ae81ff>26763233</span> })
	.<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>res</span> =&gt; {
    <span style=color:#75715e>// obtain the data to be saved
</span><span style=color:#75715e></span>		<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>data</span>
		<span style=color:#a6e22e>dao</span>.<span style=color:#a6e22e>saveData</span>(<span style=color:#a6e22e>data</span>, (<span style=color:#a6e22e>err</span>,<span style=color:#a6e22e>res</span>)=&gt;{
			<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;saved data&#39;</span>)
			<span style=color:#75715e>// save data to MongoDB and close connection
</span><span style=color:#75715e></span>			<span style=color:#a6e22e>dao</span>.<span style=color:#a6e22e>printAllData</span>( () =&gt; <span style=color:#a6e22e>dao</span>.<span style=color:#a6e22e>closeMongo</span>() )
		})
	})
	.<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>err</span> =&gt; <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>err</span>))
</code></pre></div><p>Run the code with the command</p><pre><code class=language-terminal data-lang=terminal>node index
</code></pre><p>and we obtaint he following output:</p><pre><code class=language-terminal data-lang=terminal>saved data
[ { _id: 5b41d634f3df89032c834d5b,
    aid: 26186448,
    view: 619751,
    danmaku: 12053,
    reply: 3500,
    favorite: 14961,
    coin: 40699,
    share: 1676,
    like: 20751,
    now_rank: 0,
    his_rank: 1,
    no_reprint: 1,
    copyright: 1 } ]
</code></pre><p>With this print out, we would confirm that our data is being stored in our MongoDB.</p></div><p><div class="has-text-right is-size-7"><span class=icon><i class="fas fa-pencil-alt"></i></span>Published: <time datetime=2018-07-18T00:00:00+00:00>2018-07-18</time>
by <span itemprop=author>Lei Ma</span>;</div></p><div class=is-divider></div><nav class="pagination is-centered" role=navigation aria-label=pagination><a href="https://datumorphism.leima.is/wiki/nodecrawler/basic-crawler/?ref=footer" class=pagination-previous>« Basic Node Crawler</a>
<a class=pagination-next href="https://datumorphism.leima.is/wiki/nodecrawler/restrictions/?ref=footer">Restrictions of Websites »</a></nav></div><div class="column is-4"><div class=is-divider data-content="Cite Me"></div><div class="box is-size-7 has-text-white has-background-black"><article class=media><div class=media-content><div class=content><p>Lei Ma
(2018). 'Manage Data Using MongoDB', Datumorphism, 07 April. Available at: https://datumorphism.leima.is/wiki/nodecrawler/manage-data-using-mongodb/.</p></div></div></article></div><style>#TableOfContents>ul{list-style-type:lower-greek;padding-left:0}#TableOfContents>ul>li ul{list-style-type:none;padding-left:1em}</style><div class=is-divider data-content=ToC></div><div class="box is-size-7"><article class=media><div class=media-content><div class=content><details><summary>Table of Contents</summary><div><div><nav id=TableOfContents><ul><li><a href=#the-code>The Code</a></li></ul></nav></div></div></details></div></div></article></div><script>const el=document.querySelector('details summary')
el.onclick=()=>{(function(l,o,a,d,e,r){e=o.createElement(a),r=o.getElementsByTagName(a)[0];e.async=1;e.src=d;r.parentNode.insertBefore(e,r)})(window,document,'script','/js/smoothscroll.js');el.onclick=null}
document.querySelectorAll('#TableOfContents a').forEach(link=>{link.addEventListener('click',()=>{document.querySelector(link.href.slice(link.href.indexOf('#'))).scrollIntoView({behavior:'smooth'})})})</script><div class=is-divider data-content=REFERENCES></div><div class="box is-size-7"><article class=media><div class=media-content><div class=content><p><strong>References:</strong><br><ol><li class=has-text-weight-bold><a href=https://nintha.github.io/2018/07/08/node_spider_compass/03-save_into_db/ style=text-decoration:none>03-保存数据到数据库@ninthakeey</a></li></ol></p></div></div></article></div><div class=is-divider data-content=CONNECTUME></div><div class="box is-size-7"><article class=media><div class=media-content style=width:100%><div class=content><p><strong>Current Ref:</strong><br><ul><li style=list-style:none><div>wiki/nodecrawler/manage-data-using-mongodb.md</div></li></ul></p></div></div></article></div><div id=comments class=is-divider data-content=COMMENTS></div><script src=https://utteranc.es/client.js repo=datumorphism/comments issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></article></div></section></div><div class=navtools><a class="button is-primary is-light is-outlined" alt="Edit this page" href=https://github.com/datumorphism/datumorphism.github.io/edit/hugo/content/wiki/nodecrawler/manage-data-using-mongodb.md target=blank style=position:fixed;bottom:20px;right:10px;border-radius:9999px;width:35px;height:35px><i class="fas fa-pencil-alt"></i></a><a class="button is-primary is-light is-outlined" href=#comments alt=Comments style=position:fixed;bottom:60px;right:10px;border-radius:9999px;width:35px;height:35px><i class="far fa-comments"></i></a></div></main><footer><footer class=footer><div class=container><div class="content has-text-centered"><p>Created and maintained by <a href=https://leima.is>Lei Ma</a>.
Acknowledgement: <a href=https://gohugo.io/>Hugo</a>,
<a href=https://themes.gohugo.io/bulma/>Bulma</a>, <a href=https://kausalflow.com>KausalFlow</a>.
<strong>love</strong>.<br><a class=tag href=/about>About</a>
<a class=tag href=/index.xml>Feed</a>
<a class=tag href=/data.json>JSON Data</a></p></div></div></footer><script src=https://unpkg.com/applause-button/dist/applause-button.js></script></footer><script async type=text/javascript src=/js/bulma.js></script></body></html>